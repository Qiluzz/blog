(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{381:function(t,a,s){"use strict";s.r(a);var n=s(43),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"centos7-使用-docker-部署-gitlab-gitlab-runner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#centos7-使用-docker-部署-gitlab-gitlab-runner"}},[t._v("#")]),t._v(" centos7 使用 docker 部署 gitlab + gitlab-runner")]),t._v(" "),s("h2",{attrs:{id:"快速配置应用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#快速配置应用"}},[t._v("#")]),t._v(" 快速配置应用")]),t._v(" "),s("h3",{attrs:{id:"docker-compose-yml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-yml"}},[t._v("#")]),t._v(" docker-compose.yml")]),t._v(" "),s("p",[t._v("使用 "),s("code",[t._v("docker-compose")]),t._v(" 对 "),s("code",[t._v("docker")]),t._v(" 容器集群进行快速编排")]),t._v(" "),s("p",[t._v("获取 "),s("code",[t._v("docker-gitlab")]),t._v(" 的 "),s("code",[t._v("docker-compose.yml")]),t._v(" 配置文件，进行快速构建")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://raw.githubusercontent.com/sameersbn/docker-gitlab/master/docker-compose.yml\n")])])]),s("p",[t._v("获取 "),s("code",[t._v("docker-compose.yml")]),t._v(" 文件后，进行自定义配置。")]),t._v(" "),s("h3",{attrs:{id:"配置环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置环境"}},[t._v("#")]),t._v(" 配置环境")]),t._v(" "),s("p",[t._v("打开 "),s("code",[t._v("docker-compose.yml")]),t._v(" 文件，针对 "),s("code",[t._v("gitlab")]),t._v(" 进行环境配置")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2.3'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 省略显示其他服务")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gitlab")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sameersbn/gitlab"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("13.0.6\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" redis\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" postgresql\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10080:80"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10022:22"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" gitlab"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/home/git/data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Z\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("healthcheck")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CMD"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/sbin/healthcheck"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("interval")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 5m\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("timeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10s\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("retries")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("start_period")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 5m\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DEBUG=false\n\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DB_ADAPTER=postgresql\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DB_HOST=postgresql\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DB_PORT=5432\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DB_USER=gitlab\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DB_PASS=password\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DB_NAME=gitlabhq_production\n\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" REDIS_HOST=redis\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" REDIS_PORT=6379\n\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Kolkata\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" GITLAB_TIMEZONE=Kolkata\n\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" GITLAB_HTTPS=false\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" SSL_SELF_SIGNED=false\n\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" GITLAB_HOST=localhost\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" GITLAB_PORT=10080\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" GITLAB_SSH_PORT=10022\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" GITLAB_RELATIVE_URL_ROOT=\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" GITLAB_SECRETS_DB_KEY_BASE=long"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("and"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("random"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alphanumeric"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("string\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" GITLAB_SECRETS_SECRET_KEY_BASE=long"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("and"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("random"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alphanumeric"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("string\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" GITLAB_SECRETS_OTP_KEY_BASE=long"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("and"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("random"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alphanumeric"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("string\n\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 省略其他配置")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n")])])]),s("p",[t._v("参考"),s("a",{attrs:{href:"https://github.com/sameersbn/docker-gitlab/",target:"_blank",rel:"noopener noreferrer"}},[t._v("配置文档"),s("OutboundLink")],1),t._v("，我们需要将时区设置为东八时区，设置数据混淆密匙，设置服务地址。")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" GITLAB_TIMEZONE=Asia/Shanghai\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" GITLAB_HOST=192.168.2.192\n")])])]),s("p",[t._v("设置混淆密匙，一般推荐 "),s("code",[t._v("64")]),t._v(" 位随机字符串，可以用 "),s("code",[t._v("pwgen")]),t._v(" 生成，可以安装 "),s("code",[t._v("pwgen")]),t._v(" 服务，然后运行 "),s("code",[t._v("pwgen -Bsv1 64")]),t._v(" 即可生成随机字符串。")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" GITLAB_SECRETS_DB_KEY_BASE=nvqgzJdgrmr3tqsC4F9gKVNhKvTq3N7cJPjNggR93qthNhJ3MWkc7jNmNTLRXdhX\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" GITLAB_SECRETS_SECRET_KEY_BASE=pcrf73fX4rM7bKxc7tcq3kwKWdtKKtrmmsHwT3J9rwCLMsK37PxCnXbMgnRpqJbk\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" GITLAB_SECRETS_OTP_KEY_BASE=3d9tPCzpv7rfmVgnjN9McbztRVbp4rjxWWqFbNLTCbRz9mKkpvqqWgxMq7NM7c9w\n")])])]),s("p",[t._v("同理，"),s("code",[t._v("docker-compose.yml")]),t._v(" 的其他服务也需要配置东八时区。")]),t._v(" "),s("h3",{attrs:{id:"数据卷挂载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据卷挂载"}},[t._v("#")]),t._v(" 数据卷挂载")]),t._v(" "),s("p",[t._v("数据卷挂载可对数据进行持久化保存，不会因为容器的删除而删除，数据挂载的目录数据会自动与容器内的数据同步，数据挂载的目录数据优先于容器内数据，即修改数据卷数据，会自动同步到容器内数据。")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2.3'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("5.0.9\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("loglevel warning\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Z\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("postgresql")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sameersbn/postgresql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("11"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20200524")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" postgresql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/postgresql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Z\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DB_USER=gitlab\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DB_PASS=password\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DB_NAME=gitlabhq_production\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DB_EXTENSION=pg_trgm\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gitlab")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sameersbn/gitlab"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("13.0.6\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" redis\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" postgresql\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10080:80"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10022:22"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" gitlab"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/home/git/data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Z\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("healthcheck")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CMD"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/sbin/healthcheck"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("interval")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 5m\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("timeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10s\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("retries")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("start_period")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 5m\n")])])]),s("p",[t._v("注意：数据卷的挂载，需要在宿主机提前创建好对应的目录。")]),t._v(" "),s("p",[t._v("手动创建以下目录：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("/app/volumes/gitlab/gitlab/\n/app/volumes/gitlab/postgresql/\n/app/volumes/gitlab/redis/\n")])])]),s("p",[t._v("修改对应数据卷配置：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("5.0.9\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("loglevel warning\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /app/volumes/gitlab/redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Z\n")])])]),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("postgresql")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sameersbn/postgresql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("11"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20200524")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /app/volumes/gitlab/postgresql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/postgresql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Z\n")])])]),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gitlab")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sameersbn/gitlab"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("13.0.6\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" redis\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" postgresql\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10080:80"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10022:22"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /app/volumes/gitlab/gitlab"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/home/git/data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Z\n")])])]),s("h3",{attrs:{id:"gitlab-runner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-runner"}},[t._v("#")]),t._v(" gitlab-runner")]),t._v(" "),s("p",[t._v("拉下来的 "),s("code",[t._v("docker-compose.yml")]),t._v(" 文件默认是没有 "),s("code",[t._v("gitlab-runner")]),t._v(" 的，我们需要将 "),s("code",[t._v("gitlab-runner")]),t._v(" 写到 "),s("code",[t._v("docker-compose.yml")]),t._v(" 配置上来。")]),t._v(" "),s("p",[t._v("也要先创建数据卷挂载文件目录：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("/app/volumes/gitlab-runner/config/\n")])])]),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gitlab-runner")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" gitlab/gitlab"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" gitlab\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /app/volumes/gitlab"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner/config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/gitlab"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("runner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Z\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /var/run/docker.sock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/run/docker.sock\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n")])])]),s("h2",{attrs:{id:"快速构建应用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#快速构建应用"}},[t._v("#")]),t._v(" 快速构建应用")]),t._v(" "),s("p",[t._v("将配置好的 "),s("code",[t._v("docker-compose.yml")]),t._v(" 文件放到 "),s("code",[t._v("/app/docker/gitlab/")]),t._v(" 下，执行以下命令：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /app/docker/gitlab/\n$ docker-compose up\n")])])]),s("p",[s("code",[t._v("docker-compose")]),t._v(" 会自动管理 "),s("code",[t._v("docker")]),t._v(" 容器集群，包括对镜像进行拉取、创建以及启动。")]),t._v(" "),s("p",[t._v("稍等片刻，我们即可通过 "),s("code",[t._v("http://192.168.2.192:10080/")]),t._v(" 打开 "),s("code",[t._v("gitlab")]),t._v(" 页面，第一次打开是直接设置 "),s("code",[t._v("root")]),t._v(" 账号的密码，设置密码后即可登录进入 "),s("code",[t._v("gitlab")]),t._v(" 内页。")]),t._v(" "),s("p",[t._v("英文不好的同学可以进入个人设置那里设置 "),s("code",[t._v("language")]),t._v(" 为简体中文。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.catbox.moe/7o1urw.png",alt:"设置语言"}})]),t._v(" "),s("h3",{attrs:{id:"注册runner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注册runner"}},[t._v("#")]),t._v(" 注册runner")]),t._v(" "),s("p",[t._v("什么是 "),s("code",[t._v("runner")]),t._v("，"),s("code",[t._v("runner")]),t._v(" 就是 "),s("code",[t._v("gitlab")]),t._v(" 进行可持续集成与可持续交付过程所跑的环境容器服务。")]),t._v(" "),s("p",[t._v("为了进行 "),s("code",[t._v("ci/cd")]),t._v(" => 可持续集成/可持续部署，我们需要注册 "),s("code",[t._v("runner")]),t._v("，一般我们注册的是共享 "),s("code",[t._v("runner")]),t._v("，也就是任何仓库的 "),s("code",[t._v("ci/cd")]),t._v(" 都可以在上面跑。当然，我们也可以创建多个 "),s("code",[t._v("runner")]),t._v(" 服务，为特定仓库指定 "),s("code",[t._v("runner")]),t._v("。")]),t._v(" "),s("p",[t._v("下面以注册共享 "),s("code",[t._v("runner")]),t._v(" 为例：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.catbox.moe/u581dt.png",alt:"runner列表"}})]),t._v(" "),s("p",[t._v("比如")]),t._v(" "),s("ol",[s("li",[t._v("进入 "),s("code",[t._v("runner")]),t._v(" 容器")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ docker "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it 容器ID "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("注册 "),s("code",[t._v("runner")])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ gitlab-runner register\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("输入 "),s("code",[t._v("gitlab")]),t._v(" 示例的 "),s("code",[t._v("url")])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v(" $ Please enter the gitlab-ci coordinator URL "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e.g. https://gitlab.com "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":\n http://192.168.2.192:10080/\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[t._v("输入用来注册 "),s("code",[t._v("runner")]),t._v(" 的 "),s("code",[t._v("token")])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ Please enter the gitlab-ci token "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" this runner:\nyrErncrc8XY_e5-g7bU8\n")])])]),s("ol",{attrs:{start:"5"}},[s("li",[t._v("输入 "),s("code",[t._v("runner")]),t._v(" 的描述，随后可在 "),s("code",[t._v("gitlab")]),t._v(" 界面中修改")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ Please enter the gitlab-ci description "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" this runner:\ngitlab-ci\n")])])]),s("ol",{attrs:{start:"6"}},[s("li",[t._v("输入与 "),s("code",[t._v("runner")]),t._v(" 绑定的标签（可修改）")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ Please enter the gitlab-ci tags "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" this runner "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("comma separated"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":\ngitlab-ci\n")])])]),s("ol",{attrs:{start:"7"}},[s("li",[t._v("选择 "),s("code",[t._v("runner")]),t._v(" 的执行方式（推荐"),s("code",[t._v("docker")]),t._v("）")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v(" $ Please enter the executor: ssh, docker+machine, docker-ssh+machine, kubernetes, docker, parallels, virtualbox, docker-ssh, shell:\n docker\n\n")])])]),s("ol",{attrs:{start:"8"}},[s("li",[t._v("如果选择的执行方式是 "),s("code",[t._v("docker")]),t._v("，会要求填写默认的镜像")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ Please enter the Docker image "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eg. ruby:2.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":\nalpine:latest\n")])])]),s("p",[t._v("注册成功后会在 "),s("code",[t._v("runner")]),t._v(" 容器 "),s("code",[t._v("~/etc/gitlab-runner/")]),t._v(" 目录下生成 "),s("code",[t._v("config.toml")]),t._v(" 配置文件，这时候就可以在 "),s("code",[t._v("gitlab")]),t._v(" 的管理页面中看到激活的 "),s("code",[t._v("runner")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.catbox.moe/uxrvcl.png",alt:"激活的runner"}})]),t._v(" "),s("p",[t._v("然后，对 "),s("code",[t._v("runner")]),t._v(" 进行修改，勾选 "),s("code",[t._v("runner 可以选择无标签的项目")]),t._v("（默认是同样标签的项目才能使用对应标签的 "),s("code",[t._v("runner")]),t._v("）。这样，"),s("code",[t._v("runner")]),t._v(" 就可以变为共享 "),s("code",[t._v("runner")]),t._v(" 了。")]),t._v(" "),s("p",[t._v("当我们需要专门为某个项目跑的 "),s("code",[t._v("runner")]),t._v(" 时，那就不需要勾选 "),s("code",[t._v("runner")]),t._v(" 可选择无标签选项，在下面配置添加 "),s("code",[t._v("runner")]),t._v(" 服务的项目保存即可。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.catbox.moe/leis7m.png",alt:"配置runner共享"}})]),t._v(" "),s("h2",{attrs:{id:"可持续集成-部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#可持续集成-部署"}},[t._v("#")]),t._v(" 可持续集成/部署")]),t._v(" "),s("p",[t._v("可持续集成与部署需要配置 "),s("code",[t._v(".gitlab-ci.yml")]),t._v(" 文件，"),s("code",[t._v("gitlab")]),t._v(" 会检查每个仓库根目录是否存在 "),s("code",[t._v(".gitlab-ci.yml")]),t._v(" 文件，有的话 "),s("code",[t._v("runner")]),t._v(" 则自动跑起来。")]),t._v(" "),s("p",[s("code",[t._v("gitlab")]),t._v(" 默认开启 "),s("code",[t._v("auto devops")]),t._v(" 功能，如果没有 "),s("code",[t._v(".gitlab-ci.yml")]),t._v(" 文件，则会自动运行 "),s("code",[t._v("auto devops")]),t._v("，如果没有配置 "),s("code",[t._v("Auto DevOps")]),t._v(" 功能与 "),s("code",[t._v("Kubernetes")]),t._v(" 集成的话，建议关闭默认的 "),s("code",[t._v("auto devops")]),t._v(" 功能。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.catbox.moe/kq1s50.png",alt:"关闭默认"}})]),t._v(" "),s("h3",{attrs:{id:"gitlab-ci-yml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-ci-yml"}},[t._v("#")]),t._v(" .gitlab-ci.yml")]),t._v(" "),s("p",[t._v("这是一个自动编译前端代码并发布到 "),s("code",[t._v("gitlab page")]),t._v(" 的配置文件：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("building")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("alpine    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定运行环境")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" build          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当前stage阶段为build")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("               "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# build阶段运行的脚本")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" yarn "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("registry=https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//registry.npm.taobao.org\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" yarn docs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("build\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("artifacts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 工件，可以缓存在gitlab的流水线记录中，供直接下载")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("expire_in")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 3 days   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 工件缓存的有效时间")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("              "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 路径")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" docs/.vuepress/dist/            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 工件指向的目录，这里指整个dist目录")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("                  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 缓存")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 路径")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" node_modules/     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 缓存node_mudules将大大提高ci运行的速度")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploying")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" deploy         "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当前阶段为deploy")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("               "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# deploy阶段运行的命令")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" rm "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("rf public/*   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# linux命令，递归无询问删除public目录下所有文件- mv dist/* public //将dist目录下的所有文件都移动到public目录下")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("artifacts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 工件缓存")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("expire_in")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 3 days   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 时效为3天")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("              "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 路径")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" public          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 缓存整个public目录的文件")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("only")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" master               "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ceate pages下的所有操作只在 master 分支上进行")]),t._v("\n\n")])])]),s("h3",{attrs:{id:"自动化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自动化"}},[t._v("#")]),t._v(" 自动化")]),t._v(" "),s("p",[t._v("当我们提交我们的代码后，"),s("code",[t._v("gitlab")]),t._v(" 会自动根据 "),s("code",[t._v(".gitlab-ci.yml")]),t._v(" 的配置运行 "),s("code",[t._v("runner")]),t._v("。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.catbox.moe/uwlpm2.png",alt:"提交代码"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.catbox.moe/i8uebm.png",alt:"运行通过"}})]),t._v(" "),s("p",[t._v("这样我们就实现自动化集成与部署了，大大的提高了我们的开发效率。")]),t._v(" "),s("h2",{attrs:{id:"身份认证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#身份认证"}},[t._v("#")]),t._v(" 身份认证")]),t._v(" "),s("p",[t._v("我们在 "),s("code",[t._v("gitlab")]),t._v(" 上注册了自己的账号后，为了方便身份认证，一般需要用 "),s("code",[t._v("ssh")]),t._v(" 生成身份认证密匙，这样就不需要每次访问都要输入账号密码。")]),t._v(" "),s("h3",{attrs:{id:"配置shh密匙"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置shh密匙"}},[t._v("#")]),t._v(" 配置SHH密匙")]),t._v(" "),s("p",[t._v("在我们的电脑 "),s("code",[t._v("git bash")]),t._v(" 输入：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ ssh-keygen -t rsa -C "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"我们在gitlab注册的邮箱"')]),t._v(" -f ~/.ssh/gitlab_id_rsa\n")])])]),s("p",[t._v("此时会在我们电脑用户根目录的 "),s("code",[t._v("/.ssh")]),t._v(" 下生成私匙跟公匙：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("gitlab_id_rsa\ngitlab_id_rsa.pub\n")])])]),s("p",[t._v("打开 "),s("code",[t._v("pub")]),t._v(" 后缀的公匙，复制粘贴到 "),s("code",[t._v("gitlab")]),t._v(" 用户设置，保存即可。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.catbox.moe/o9sp5y.png",alt:"身份认证"}})]),t._v(" "),s("h3",{attrs:{id:"github与gitlab共存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#github与gitlab共存"}},[t._v("#")]),t._v(" github与gitlab共存")]),t._v(" "),s("p",[t._v("假设我们之前就已经生成了 "),s("code",[t._v("github")]),t._v(" 的 "),s("code",[t._v("ssh")]),t._v(" 密匙:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("github_id_rsa\ngithub_id_rsa.pub\n")])])]),s("p",[t._v("在我们电脑的用户目录 "),s("code",[t._v("/.ssh/")]),t._v(" 下创建 "),s("code",[t._v("config")]),t._v(" 文件，配置如下，保存即可:")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#github")]),t._v("\nHost github.com\nHostName github.com\nIdentityFile C:/Users/jwchan/.ssh/github\n_id_rsa\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#gitlab")]),t._v("\nHost "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".2.192\nHostName "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".2.192\nIdentityFile C:/Users/jwchan/.ssh/gitlab_id_rsa\n")])])]),s("p",[t._v("这样，我们在提交代码的时候，会自动区分目标服务器从而使用对应的 "),s("code",[t._v("ssh")]),t._v(" 密匙。")]),t._v(" "),s("h3",{attrs:{id:"git基本操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#git基本操作"}},[t._v("#")]),t._v(" git基本操作")]),t._v(" "),s("ol",[s("li",[t._v("拉取仓库")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone ssh://git@192.168.2.192:10022/jwchan/blog.git\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("进入仓库贡献代码")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /blog/\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("查看仓库代码修改状态")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" status\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[t._v("添加代码缓冲区")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n")])])]),s("ol",{attrs:{start:"5"}},[s("li",[t._v("提交代码并注释")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" commit -m "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[fix]: bug"')]),t._v("\n")])])]),s("ol",{attrs:{start:"6"}},[s("li",[t._v("推送代码到远程仓库")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" push \n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);